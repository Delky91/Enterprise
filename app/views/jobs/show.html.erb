<p style="color: green"><%= notice %></p>

<%= render @job %>

<!-- Links -->
<% if current_user && current_user.role == 'admin' %>
  <div class="d-flex gap-4 align-items-center my-5">
    <%= link_to "Editar oferta", edit_job_path(@job), class: "btn btn-sm btn-outline-primary" %>
    <%= button_to "Eliminar oferta", @job, class: "btn btn-sm btn-outline-danger", method: :delete %>
  </div>
  <hr class="mb-5">
<% end %>

<!-- Formulario de postulaciÃ³n -->
<% if current_user && current_user.role != 'admin' %>
  <div class="my-4">
    <h2>Postula</h2>
    <%= simple_form_for [@job, @job_application] do |f| %>
      <%= f.input :message, label: "Deja tu mensaje para postular", as: :text, input_html: { rows: 5 } %>
      <%= f.button :submit, "Application", class: "btn btn-outline-primary" %>
    <% end %>
  </div>
  <hr class="mt-5">
<% end %>

<!-- Postulaciones solo son vistas por administrador -->
<% if current_user %>
  <% if @job_applications.present? %>
    <h2>Postulaciones:</h2>

    <!-- Verifica si es admin -->
    <% if current_user.role == 'admin' %>

      <!-- Muestra todas las postulaciones al admin -->
      <% @job_applications.each do |job_application| %>
        <div class="my-2 border p-2 rounded-2 application shadow-sm">
          <div class="d-flex gap-2 align-items-center my-2">
            <% if job_application.user.profile_picture.present? %>
              <%= image_tag job_application.user.profile_picture, class: "profileWraper rounded-5" %>
            <% end %>
            <p class="mb-0"><%= job_application.user.name %> se ha postulado.</p>
          </div>
          <hr>
          <%= simple_format(job_application.message) %>
        </div>
      <% end %>

      <!-- Si no es admin verifica si el usuario ya postulo -->
    <% else %>
      <p class="text-danger">Ya te has postulado a esta oferta de trabajo.</p>
    <% end %>

  <% else %>
    <p>No hay postulaciones para este trabajo.</p>
  <% end %>
<% end %>
